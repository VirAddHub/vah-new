groups:
- name: vah_latency
  rules:
  - record: job_route:request_duration_ms:p95
    expr: histogram_quantile(
            0.95,
            sum by (le, route) (rate(vah_http_request_duration_ms_bucket[5m]))
          )
  - record: job:db_query_duration_ms:p95
    expr: histogram_quantile(
            0.95,
            sum by (le) (rate(vah_db_query_duration_ms_bucket[5m]))
          )

- name: vah_errors
  rules:
  - record: job:request_errors_ratio
    expr: sum(rate(vah_http_requests_total{code=~"5.."}[5m]))
         / clamp_min(sum(rate(vah_http_requests_total[5m])), 1)
