@base = http://localhost:3000/api/bff
@adminEmail = admin@virtualaddresshub.co.uk
@adminPass = Admin123!

### 01) CSRF via BFF (must return token + Set-Cookie)
GET {{base}}/auth/csrf
> {% client.global.set("csrf", response.body.token || response.body.csrfToken || ""); %}

### 02) Login via BFF (must set session cookies on FE origin)
POST {{base}}/auth/login
x-csrf-token: {{csrf}}
content-type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPass}}"
}

### 03) Whoami (protected, should show user)
GET {{base}}/auth/whoami

### 04) Profile (protected)
GET {{base}}/profile

### 05) Webhook (bypass CSRF, should 2xx)
POST {{base}}/webhooks/sumsub
content-type: application/json

{
  "type": "applicantReviewed",
  "reviewStatus": "completed",
  "reviewResult": { "reviewAnswer": "GREEN" },
  "applicantId": "demo"
}

### 06) CSRF for logout and perform logout
GET {{base}}/auth/csrf
> {% client.global.set("csrf", response.body.token || response.body.csrfToken || ""); %}
POST {{base}}/auth/logout
x-csrf-token: {{csrf}}
